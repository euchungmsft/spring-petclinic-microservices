<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>README</title></head><body><article class="markdown-body"><h1 id="deploy-spring-boot-apps-using-azure-spring-cloud-and-azure-services">Deploy Spring Boot apps using Azure Spring Cloud and Azure Services<a class="headerlink" href="#deploy-spring-boot-apps-using-azure-spring-cloud-and-azure-services" title="Permanent link"></a></h1>
<p>Azure Spring Cloud enables you to easily run a Spring Boot applications on Azure.</p>
<p>This example shows you how to deploy an existing Java Spring Boot/Cloud application to Azure. When you&rsquo;re finished, you can continue to manage the application with Azure services via the Azure CLI, Bicep templates or switch to using the Azure Portal.</p>
<p>It&rsquo;s forked from <a href="https://github.com/Azure-Samples/spring-petclinic-microservices">Azure-Samples/spring-petclinic-microservices</a> and originally from <a href="https://github.com/spring-petclinic/spring-petclinic-microservices">spring-petclinic/spring-petclinic-microservices</a>. Code change&rsquo;s minimized, all deployment models work properly which introduced in the previous repos such as</p>
<ul>
<li><a href="https://github.com/euchungmsft/spring-petclinic-microservices/blob/gene/README-petclinic.md#starting-services-locally-without-docker">Starting services locally without Docker</a></li>
<li><a href="https://github.com/euchungmsft/spring-petclinic-microservices/blob/gene/README-petclinic.md#starting-services-locally-with-docker-compose">Starting services locally with docker-compose</a></li>
<li><a href="https://github.com/euchungmsft/spring-petclinic-microservices/blob/gene/README-azure-examples.md">Deploying Spring Boot apps using Azure Spring Cloud and MySQL</a></li>
</ul>
<p>You will need to check this config repos too. They provide app configs to your runtime.</p>
<ul>
<li><a href="https://github.com/euchungmsft/spring-petclinic-microservices-config">euchungmsft/spring-petclinic-microservices-config</a> - configuration as example on public</li>
<li><a href="https://github.com/euchungmsft/spring-petclinic-microservices-config-private">euchungmsft/spring-petclinic-microservices-config-private</a> - working configuration on private protected by GitHub authentication</li>
</ul>
<h2 id="contents">Contents<a class="headerlink" href="#contents" title="Permanent link"></a></h2>
<p>Deploy Spring Boot apps using Azure Spring Cloud and Azure Services</p>
<ul>
<li><a href="#deploy-spring-boot-apps-using-azure-spring-cloud-and-azure-services">Introduction</a></li>
<li><a href="#what-you-will-experience">What will you experience</a></li>
<li>
<p><a href="#what-you-will-need">What you will need</a></p>
</li>
<li>
<p><a href="#the-app-petclinic">The App, PetClinic</a></p>
</li>
<li><a href="#the-application-architecture-with-all-components-and-elements">The application architecture</a></li>
<li><a href="#deployment-architecture---basic">Deployment architecture - Basic</a></li>
<li>
<p><a href="#deployment-architecture---standard">Deployment architecture - Standard</a></p>
</li>
<li>
<p><a href="#deploying-petclinic-app-step-by-step-instruction">Deploying PetClinic App, step by step instruction</a></p>
</li>
<li><a href="#clone-and-build-the-repo">Cloning the repo</a></li>
<li><a href="#configure-your-project">Configuring your project</a></li>
<li><a href="#provision-azure-services">Provisioning Azure Services</a></li>
<li><a href="#configure-and-integrate-the-azure-services">Configure and integrate the Azure services</a></li>
<li><a href="#configure-petclinic-app">Configure PetClinic app</a></li>
<li><a href="#configure-config-server-by-azure-spring-cloud">Configure config-server by Azure Spring Cloud</a></li>
<li><a href="#deploy-your-apps">Deploy your Apps</a></li>
<li><a href="#testing-your-apps">Testing the app</a></li>
<li>
<p><a href="#monitoring-your-app">Monitoring the app</a></p>
</li>
<li>
<p><a href="#petclinic-swaggeroas3-for-api-management-integration">PetClinic Swagger/OAS3 for API Management Integration</a></p>
</li>
<li>
<p><a href="#fully-managed-testing-for-petclinic-app">Fully managed testing for PetClinic app</a></p>
</li>
<li>
<p><a href="#petclinic-on-automated-cicd-with-github-action">PetClinic on Automated CI/CD with GitHub Action</a></p>
</li>
<li><a href="#ci-and-cicd-workflows">CI and CI/CD Workflows</a></li>
<li><a href="#configure-workflows-for-ci">Configure workflows for CI</a></li>
<li><a href="#configure-workflows-for-cicd">Configure workflows for CI/CD</a></li>
<li>
<p><a href="#reviewing-workflows">Reviewing workflows</a></p>
</li>
<li>
<p><a href="#automated-cicd-in-practice">Automated CI/CD in practice</a></p>
</li>
</ul>
<h2 id="what-you-will-experience">What you will experience<a class="headerlink" href="#what-you-will-experience" title="Permanent link"></a></h2>
<p>You will</p>
<ul>
<li>Build an existing Spring Boot/Cloud applications</li>
<li>Provision Azure Spring Cloud service and Azure Services using Bicep template from commandline or/and portal. See <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview?tabs=bicep">what is Bicep</a></li>
<li>Deploy applications to Azure</li>
<li>Bind applications to Azure services</li>
<li>Open and test the applications</li>
<li>Monitor the applications</li>
<li>Integrate with APIM using Swagger doc</li>
<li>Automate deployments using GitHub Actions</li>
<li>Find how to store sensitive informtion to Azure Key Vault Secret and how to use/manage them</li>
<li>Find how to implement second level cache transparently using Azure Cache for Redis for better performance</li>
<li>Find how to implement Spring Cloud Stream backed by Azure Event Hub replacing Kafka you might have been using</li>
<li>Find how to implement Spring Data backed by Azure CosmosDB replacing MongoDB </li>
</ul>
<h2 id="what-you-will-need">What you will need<a class="headerlink" href="#what-you-will-need" title="Permanent link"></a></h2>
<p>In order to deploy a Java app to cloud, you need an Azure subscription. If you do not already have an Azure 
subscription, you can activate your <a href="https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/">MSDN subscriber benefits</a> or sign up for a <a href="/S:/azure.microsoft.com/free/%29">free Azure account</a>.</p>
<p>In addition, you will need the following:</p>
<p>| <a href="https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI version 2.17.1, higher or latest</a> 
| <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/install">Bicep latest</a>
| <a href="https://jdk.java.net/11/">Java 11</a> 
| <a href="https://maven.apache.org/download.cgi">Maven latest</a> 
| <a href="https://dev.mysql.com/downloads/shell/">MySQL CLI latest</a>
| <a href="https://git-scm.com/">Git latest</a>
| <a href="https://stedolan.github.io/jq/download/">jq utility latest</a></p>
<blockquote>
<p>Note: The Bash shell. While Azure CLI should behave identically on all environments, shell semantics vary. Therefore, only bash can be used with the commands in this repo. WSL2/Ubuntu is my recommendation to complete this example. See <a href="https://docs.microsoft.com/en-us/windows/wsl/install">this</a> for WSL Installation on your Windows, see <a href="https://ubuntu.com/wsl">this</a> for Ubuntu (18+) download. Azure Cloud Shell is another good choice too. See <a href="https://docs.microsoft.com/en-us/azure/cloud-shell/overview">this</a></p>
</blockquote>
<h3 id="before-you-start">Before you start<a class="headerlink" href="#before-you-start" title="Permanent link"></a></h3>
<p>Before you start, install the Azure Spring Cloud extension for the Azure CLI using the following command</p>
<div class="highlight"><pre>    az extension add --name spring-cloud
</pre></div>

<blockquote>
<p>Note: <code>spring-cloud</code> CLI extension <code>2.1.0</code> or later is a pre-requisite to enable the latest Java in-process agent for Application Insights. If you already have the CLI extension, you may need to upgrade to the latest using &ndash;</p>
</blockquote>
<div class="highlight"><pre>    az extension update --name spring-cloud
</pre></div>

<h2 id="the-app-petclinic">The App, PetClinic<a class="headerlink" href="#the-app-petclinic" title="Permanent link"></a></h2>
<h3 id="the-application-architecture-with-all-components-and-elements">The application architecture with all components and elements<a class="headerlink" href="#the-application-architecture-with-all-components-and-elements" title="Permanent link"></a></h3>
<p>Based on the PetClinic App, <a href="https://github.com/Azure-Samples/spring-petclinic-microservices">Azure-Samples/spring-petclinic-microservices</a> we&rsquo;ve added Azure services with integration, and Consumer service which communicates with the app services over Event Hub</p>
<p><img alt="Components and Elements" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/architecture-components-and-elements.png" /></p>
<ul>
<li>All app components communicate with KeyVaults to retrieve sensitive information stored in secrets</li>
<li>All app components bound to Azure Files as permanent storage</li>
<li>All app components with data acess gets second level cache on Redis</li>
<li>All components bound to Log Analytics to send logs and metrics</li>
<li>Endpoints to <code>admin-server</code> and <code>api-gateway</code> for extenal access</li>
<li>config-server in Azure Spring Cloud gets the app configs from repos on GitHub with authentication</li>
<li>CI/CD by GitHub Actions are added with appropriate authentication to access the resources on Azure</li>
</ul>
<h3 id="deployment-architecture-basic">Deployment architecture - Basic<a class="headerlink" href="#deployment-architecture-basic" title="Permanent link"></a></h3>
<p>Simple and basic deployment model for the purpose of test</p>
<p><img alt="Deployment architecture, Basic" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/architecture-deployments-basic.png" /></p>
<ul>
<li>Where the customer doesn&rsquo;t care about network dedication </li>
<li>Each of Azure Services allows access with access control over the network</li>
</ul>
<h3 id="deployment-architecture-standard">Deployment architecture - Standard<a class="headerlink" href="#deployment-architecture-standard" title="Permanent link"></a></h3>
<p>Secure and dedicated deployment for serious purpose</p>
<p><img alt="Deployment architecture, Standard" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/architecture-deployments-standard.png" /></p>
<ul>
<li>All app components are deployed in the customer VNet which enables them to access directly to its components such as AKS, load balancers and so on</li>
<li>Each of Azure Services allow to access over private endpoints deployed in the VNet</li>
</ul>
<h2 id="deploying-petclinic-app-step-by-step-instruction">Deploying PetClinic App, step by step instruction<a class="headerlink" href="#deploying-petclinic-app-step-by-step-instruction" title="Permanent link"></a></h2>
<h3 id="clone-and-build-the-repo">Clone and build the repo<a class="headerlink" href="#clone-and-build-the-repo" title="Permanent link"></a></h3>
<blockquote>
<p>Note: My recommendation is to start to fork these repos to yours first than cloning these right away from this repo. It helps you to run later half of this document, to config GitHub Action, you need to get your developer token for authentication, and to store your credentials in the repo</p>
</blockquote>
<p>Create a new folder and clone the repositories to your environment</p>
<div class="highlight"><pre>mkdir <span class="o">[</span>your <span class="nb">source </span>code folder name<span class="o">]</span>
<span class="nb">cd</span> <span class="o">[</span>your <span class="nb">source </span>code folder name<span class="o">]</span>
git clone <span class="o">[</span>your <span class="nb">source </span>code repo URL, or https://github.com/euchungmsft/spring-petclinic-microservices<span class="o">]</span>
git clone <span class="o">[</span>your config repo URL, or https://github.com/euchungmsft/spring-petclinic-microservices-config<span class="o">]</span>
</pre></div>

<p>spring-petclinic-microservices is source code and working repo, spring-petclinic-microservices-config is for the configuration repo to push back to GitHub. </p>
<p>Change directory and build the project.</p>
<div class="highlight"><pre><span class="nb">cd </span>spring-petclinic-microservices
mvn clean package -DskipTests -Denv<span class="o">=</span>cloud
</pre></div>

<p>This will take a few minutes.</p>
<h3 id="configure-your-project">Configure your project<a class="headerlink" href="#configure-your-project" title="Permanent link"></a></h3>
<p>Rename .env-example to .env and update it</p>
<div class="highlight"><pre>mv .env-example .env
</pre></div>

<p>Open .env</p>
<div class="highlight"><pre><span class="nv">PROJECT_NAME</span><span class="o">=[</span>your project name, to give names to all resoures<span class="o">]</span>

<span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span>-rg
<span class="nv">REGION</span><span class="o">=</span>westus
..
..
</pre></div>

<p>PROJECT_NAME is for automatically naming the resources. MY_UPN is User Principal Name of your Azure portal account. Check this from Azure Active Directory - Users</p>
<p>Login to the Azure CLI and choose your active subscription. Be sure to choose the active subscription that is whitelisted for Azure Spring Cloud</p>
<p><div class="highlight"><pre>az login 
</pre></div>
or </p>
<div class="highlight"><pre>az login --use-device-code
</pre></div>

<p>You need a Resource Group and Service Principal to authenticate from your environment. Simply run <code>bin/init.sh</code>, it consist of steps listed below</p>
<div class="highlight"><pre>bin/init.sh
</pre></div>

<ol>
<li>Creating a Resource Group</li>
<li>Creating a Service Principal</li>
<li>Updating .env</li>
<li>Set defaults in your environment with az command</li>
</ol>
<p>and you&rsquo;ll get something like this as a result of step-2. Save it for later steps</p>
<div class="highlight"><pre>{
  &quot;clientId&quot;: &quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;,
  &quot;clientSecret&quot;: &quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;,
  &quot;subscriptionId&quot;: &quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;,
  &quot;tenantId&quot;: &quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;,
  &quot;activeDirectoryEndpointUrl&quot;: &quot;https://login.microsoftonline.com&quot;,
  &quot;resourceManagerEndpointUrl&quot;: &quot;https://management.azure.com/&quot;,
  &quot;activeDirectoryGraphResourceId&quot;: &quot;https://graph.windows.net/&quot;,
  &quot;sqlManagementEndpointUrl&quot;: &quot;https://management.core.windows.net:8443/&quot;,
  &quot;galleryEndpointUrl&quot;: &quot;https://gallery.azure.com/&quot;,
  &quot;managementEndpointUrl&quot;: &quot;https://management.core.windows.net/&quot;
}
</pre></div>

<p>.env must be updated like this already. Check AZURE_CLIENT_ID, AZURE_CLIENT_SECRET, AZURE_TENANT_ID if they are correct</p>
<div class="highlight"><pre>AZURE_CLIENT_ID=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
AZURE_CLIENT_SECRET=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
AZURE_TENANT_ID=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
AZURE_OBJECT_ID=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
</pre></div>

<p>AZURE_OBJECT_ID is automatically updated in the shell script with command like below. Once you&rsquo;ve done <code>bin/init.sh</code> successfully, you don&rsquo;t have to run this separately</p>
<div class="highlight"><pre>az ad sp show --id $AZURE_CLIENT_ID | jq -r .objectId
</pre></div>

<h3 id="provision-azure-services">Provision Azure Services<a class="headerlink" href="#provision-azure-services" title="Permanent link"></a></h3>
<p>Load all required variables in your environment</p>
<div class="highlight"><pre>source ./.env
</pre></div>

<p>Set default sunscription to use in this example</p>
<div class="highlight"><pre>az account set --subscription ${SUBSCRIPTION}
</pre></div>

<p>Provision infrastructure components and Azure Spring Cloud</p>
<div class="highlight"><pre>az deployment group create \
 -g $RESOURCE_GROUP \
 -f iac/bicep/spc-main.bicep \
 --parameters location=$REGION \
  projectName=$PROJECT_NAME
</pre></div>

<p>Or alternatively on the portal,</p>
<p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Feuchungmsft%2Fspring-petclinic-microservices%2Fgene%2Fiac%2Fspc-main.json"><img alt="Deploy To Azure" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/deploytoazure.svg" /></a> 
<a href="http://armviz.io/#/?load=https%3A%2F%2Fraw.githubusercontent.com%2Feuchungmsft%2Fspring-petclinic-microservices%2Fgene%2Fiac%2Fspc-main.json"><img alt="Visualize" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/visualizebutton.svg" /></a></p>
<p>It consists of 
1. VNet creation, optionally when it&rsquo;s on Standard sku (Basic as default)
2. Storage Account creation with a blob and fileshare
3. Spring Cloud creation (Basic as default)</p>
<p>Check <code>iac/bicep/spc-main.bicep</code> for further details</p>
<p>Provision Azure services</p>
<div class="highlight"><pre>az deployment group create \
 -g $RESOURCE_GROUP \
 -f iac/bicep/services-main.bicep \
 --parameters location=$REGION \
  projectName=$PROJECT_NAME \
  database_name=$MYSQL_DATABASE_NAME \
  mysql_adminUsername=$MYSQL_SERVER_ADMIN_NAME \
  mysql_adminPassword=$MYSQL_SERVER_ADMIN_PASSWORD \
  servicePrincipal=&quot;{ \&quot;clientId\&quot;: \&quot;$AZURE_CLIENT_ID\&quot;, 
  \&quot;tenantId\&quot;: \&quot;$AZURE_TENANT_ID\&quot;, 
  \&quot;objectId\&quot;: \&quot;$AZURE_OBJECT_ID\&quot; }&quot;
</pre></div>

<p>Or alternatively on the portal, </p>
<p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Feuchungmsft%2Fspring-petclinic-microservices%2Fgene%2Fiac%2Fservices-main.json"><img alt="Deploy To Azure" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/deploytoazure.svg" /></a> 
<a href="http://armviz.io/#/?load=https%3A%2F%2Fraw.githubusercontent.com%2Feuchungmsft%2Fspring-petclinic-microservices%2Fgene%2Fiac%2Fservices-main.json"><img alt="Visualize" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/visualizebutton.svg" /></a></p>
<p>It consists of 
1. KeyVault creation 
2. MySQL creation 
3. Event Hub creation 
4. Redis creation 
5. Cosmos DB creation 
6. APIM creation </p>
<p>Check <code>iac/bicep/services-main.bicep</code> for further details</p>
<p>Configure log analytics</p>
<div class="highlight"><pre>bin/loganalytics-diagnostics.sh
</pre></div>

<p>It consists of 
1. Log Analytics workspace creation
2. Log Analytics config for Spring Cloud 
3. Diagnostic Settings sending logs and metrics from Spring Cloud to Log Analytics</p>
<p>To add Application Insights in your environment, on your portal, select your spring cloud instance, click on Application Insights blade on the left, check on &lsquo;Enable Application Insights&rsquo;, Click on &lsquo;Create New&rsquo; link, give it a new name for your App Insights instance.</p>
<p><img alt="Appplication Insights creation" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-creation.png" /></p>
<h3 id="configure-and-integrate-the-azure-services">Configure and integrate the Azure services<a class="headerlink" href="#configure-and-integrate-the-azure-services" title="Permanent link"></a></h3>
<p>Give permission to access KeyVault secrets</p>
<div class="highlight"><pre>az keyvault set-policy --name $KEY_VAULT \
--upn $MY_UPN \
--secret-permissions all

az keyvault set-policy --name $KEY_VAULT \
--object-id $AZURE_OBJECT_ID \
--secret-permissions all
</pre></div>

<p>Initialize MySQL</p>
<div class="highlight"><pre>mysql -u ${MYSQL_SERVER_ADMIN_LOGIN_NAME} \
 -h ${MYSQL_SERVER_FULL_NAME} \
 -P 3306 &quot;--password=$MYSQL_SERVER_ADMIN_PASSWORD&quot; \
 -e &quot;--CREATE DATABASE $MYSQL_DATABASE_NAME;
CREATE USER &#39;root&#39; IDENTIFIED BY &#39;$MYSQL_DATABASE_NAME&#39;;
GRANT ALL PRIVILEGES ON petclinic.* TO &#39;root&#39;;
CALL mysql.az_load_timezone();
SELECT name FROM mysql.time_zone_name;
quit
&quot;
</pre></div>

<p>Database &lsquo;petclinic&rsquo; as default is already been created in the previous step. Just skipping it in this command line</p>
<p>If you get trouble to access your MySQL from your environment, Cloud Shell is an easy walkaround in this step. Put <code>.env</code> on your Cloud Shell, run <code>source ./.env</code> then run the command line above</p>
<p>Adding Storage Account</p>
<div class="highlight"><pre>KEY0=`az storage account keys list -g $RESOURCE_GROUP --account-name $STORAGE_ACCOUNT_NAME  | jq -r .[0].value`
echo $KEY0
az spring-cloud storage add \
 --storage-type StorageAccount \
 --account-key $KEY0 \
 --account-name $STORAGE_ACCOUNT_NAME \
 --name $SHARE_NAME
</pre></div>

<h3 id="configure-petclinic-app">Configure PetClinic app<a class="headerlink" href="#configure-petclinic-app" title="Permanent link"></a></h3>
<p>In your <code>spring-petclinic-microservices-config</code> repo, open <code>application.yml</code>. Find <code>on-profile: mysql</code> section in the middle. The app will work with this profile</p>
<div class="highlight"><pre>spring:
  config:
    activate:
      on-profile: mysql
  datasource:
    schema: classpath*:db/mysql/schema.sql
    data: classpath*:db/mysql/data.sql
    url: &lt;your mysql connection string&gt;
    username: &lt;your mysql user name&gt;
    password: &lt;secret-name:spring-datasource-password&gt;
    initialization-mode: ALWAYS
...
  cloud:
    azure:
      eventhub:
        connection-string: &lt;your event hub connection string&gt;
        checkpoint-storage-account: &lt;your storage account name for checkpoint&gt;
        checkpoint-access-key: &lt;your storage account access key for checkpoint&gt;
        checkpoint-container: &lt;your blob container name for checkpoint&gt;
        namespace: &lt;your event hub namespace&gt;
    stream:
      function:
        definition: consume;supply
      bindings:
        consume-in-0:
          destination: &lt;your event hub name&gt;
          group: $Default
        supply-out-0:
          destination: &lt;your event hub name&gt;
</pre></div>

<p>Commit and push it to your remote repo</p>
<div class="highlight"><pre>git remote add origin https://github.com/&lt;your gh account name&gt;/spring-petclinic-microservices-config
git push -u origin master
</pre></div>

<h3 id="configure-config-server-by-azure-spring-cloud">Configure config-server by Azure Spring Cloud<a class="headerlink" href="#configure-config-server-by-azure-spring-cloud" title="Permanent link"></a></h3>
<p>Back to <code>spring-petclinic-microservices</code>, make a copy <code>application.yml.example</code> to <code>application.yml</code></p>
<div class="highlight"><pre>cp application.yml.example application.yml
</pre></div>

<p>Customize <code>application.yml</code> </p>
<div class="highlight"><pre>spring:
  cloud:
    config:
      server:
        git:
          uri: [your config repo url]
          username: [your login id at GitHub]
          password: [your developer token at GitHub]
          label: main
        native:
          search-locations: classpath:.
  profiles:
    active: native 
</pre></div>

<p>Your developer token is from your GitHub account setttings. See <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">this</a> for further details</p>
<blockquote>
<p>Note: don&rsquo;t remove spring.cloud.config.server.git.label</p>
</blockquote>
<p>Once config-server configuration&rsquo;s ready, run this from your command line</p>
<div class="highlight"><pre>az spring-cloud config-server set \
 --config-file application.yml \
 --name ${SPRING_CLOUD_SERVICE}
</pre></div>

<p>Once you have done config server settings, you&rsquo;ll see it like this on your portal UI</p>
<p><img alt="Config Server" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-config-server.png" /></p>
<p>Once you have done all service deployments, you&rsquo;ll see something like this in your resource group</p>
<p><img alt="Resource Group Overview" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-resourcegroup-overview.png" /></p>
<p>For Deployments </p>
<p><img alt="Resource Group Depoyments" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-resourcegroup-deployments.png" /></p>
<p>Now you&rsquo;re ready to deploy your app.</p>
<p>This example uses redisson for second level cache with Redis. You need to create redisson config first with the brand new Redis instance that you have created in the previous step, and copy it to all services that second level cache&rsquo;s configured - <code>customer-service</code>, <code>vets-service</code>, <code>visits-service</code> </p>
<div class="highlight"><pre>KEY0=`az redis list-keys --name ${PROJECT_NAME}-redis --resource-group ${RESOURCE_GROUP} | jq -r .primaryKey`
echo &quot;{\&quot;singleServerConfig\&quot;:{\&quot;address\&quot;: \&quot;redis://${PROJECT_NAME}-redis.redis.cache.windows.net:6379\&quot;, \&quot;password\&quot;: \&quot;$KEY0\&quot;}}&quot; &gt; redisson.json
cat redisson.json

cp redisson.json spring-petclinic-${CUSTOMERS_SERVICE}/src/main/resources/
cp redisson.json spring-petclinic-${VETS_SERVICE}/src/main/resources/
cp redisson.json spring-petclinic-${VISITS_SERVICE}/src/main/resources/ 
</pre></div>

<p>Rebuild the apps with the redisson updates</p>
<div class="highlight"><pre>mvn clean package -DskipTests -Denv=cloud
</pre></div>

<blockquote>
<p>Note: To run PetClinic app locally, See this <a href="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/README-local.md">document</a></p>
</blockquote>
<h3 id="deploy-your-apps">Deploy your Apps<a class="headerlink" href="#deploy-your-apps" title="Permanent link"></a></h3>
<p>App deployment consists of follwoing steps</p>
<ol>
<li>Create apps on your Azure Spring Cloud instance</li>
<li>Append persistent storage to your apps created</li>
<li>Deploy the apps</li>
<li>Browse logs </li>
</ol>
<p>These steps are repeating, for your convenience, there&rsquo;s a bash script <code>bin/spring-cloud.sh</code>, which helps you to run those steps easily</p>
<h4 id="create-apps">Create Apps<a class="headerlink" href="#create-apps" title="Permanent link"></a></h4>
<div class="highlight"><pre>bin/spring-cloud.sh create api-gateway
bin/spring-cloud.sh create admin-server
bin/spring-cloud.sh create customers-service
bin/spring-cloud.sh create vets-service
bin/spring-cloud.sh create visits-service
bin/spring-cloud.sh create consumer-service
</pre></div>

<p>Run all of these at once. It normally takes minutes. Both config and discover servers are a part of Azure Spring Cloud. You don&rsquo;t have to deploy both</p>
<h4 id="append-persistent-storage-to-your-apps">Append persistent storage to your apps<a class="headerlink" href="#append-persistent-storage-to-your-apps" title="Permanent link"></a></h4>
<div class="highlight"><pre>bin/spring-cloud.sh append-persistent-storage customers-service
bin/spring-cloud.sh append-persistent-storage vets-service
bin/spring-cloud.sh append-persistent-storage visits-service
bin/spring-cloud.sh append-persistent-storage consumer-service
</pre></div>

<p>Run all of these at once. We only bind the storage to the app components, not for <code>api-gateway</code>, <code>admin-server</code></p>
<h4 id="deploy-apps">Deploy apps<a class="headerlink" href="#deploy-apps" title="Permanent link"></a></h4>
<div class="highlight"><pre>bin/spring-cloud.sh deploy api-gateway
bin/spring-cloud.sh deploy admin-server
bin/spring-cloud.sh deploy customers-service
bin/spring-cloud.sh deploy vets-service
bin/spring-cloud.sh deploy visits-service
bin/spring-cloud.sh deploy consumer-service
</pre></div>

<p>Run all of these at once. It normally takes minutes</p>
<h4 id="browse-logs">Browse logs<a class="headerlink" href="#browse-logs" title="Permanent link"></a></h4>
<div class="highlight"><pre>bin/spring-cloud.sh logs api-gateway
bin/spring-cloud.sh logs admin-server
bin/spring-cloud.sh logs customers-service
bin/spring-cloud.sh logs vets-service
bin/spring-cloud.sh logs visits-service
bin/spring-cloud.sh logs consumer-service
</pre></div>

<p>You can run these separetely if neccessary</p>
<p>Use <code>bin/spring-cloud.sh</code> command for <code>delete</code>, <code>stop</code>, <code>start</code>, <code>restart</code> of your apps</p>
<p>Once you have done all app deployments, you&rsquo;ll see something like this </p>
<p><img alt="Spring Cloud Apps" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-springcloud-apps.png" /></p>
<p>Both of <code>api-gateway</code> and admin servers are assigned endpoints. On your portal UI, select your Spring Cloud instance, click on Apps, select <code>api-gateway</code> from right, click on the URL on Overview</p>
<p><img alt="api-gateway overview" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-api-gateway.png" /></p>
<p>Navigate from menu on the top</p>
<p><img alt="Petclinic Main" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-petclinic-main.png" />
<img alt="Petclinic Customers" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-petclinic-customers.png" />
<img alt="Petclinic Visits" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-petclinic-visits.png" />
<img alt="Petclinic Vets" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-petclinic-vets.png" /></p>
<h3 id="testing-your-apps">Testing your apps<a class="headerlink" href="#testing-your-apps" title="Permanent link"></a></h3>
<p>You can simply run these commands from your shell</p>
<div class="highlight"><pre>curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/owners
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/owners/4
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/owners/ 
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/petTypes
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/owners/3/pets/4
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/owners/6/pets/8/
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/vet/vets
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/visit/owners/6/pets/8/visits
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/visit/owners/6/pets/8/visits
</pre></div>

<p>Those are the APIs that you can access over <code>api-gateway</code> or directly. But if you want to access app components directly for test purpose, you need to assign endpoints to them first</p>
<p>And these are are Actuator endpoints by Spring Boot for your test and monitor. </p>
<p>What&rsquo;s Actuators ? They bring production-ready features to the Spring Boot apps - Monitoring the apps, gathering metrics, understanding traffic, or the state of our database become trivial with this dependency.
Actuator is mainly used to expose operational information about the running application — health, metrics, info, dump, env, etc. It uses HTTP endpoints or JMX beans to enable us to interact with it. See <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html">this</a> for further details</p>
<div class="highlight"><pre>curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/actuator/
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/actuator/env
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/actuator/configprops
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/actuator
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/actuator/env
curl -X GET https://${SPRING_CLOUD_SERVICE}-${API_GATEWAY}.azuremicroservices.io/api/customer/actuator/configprops
</pre></div>

<h3 id="monitoring-your-app">Monitoring your app<a class="headerlink" href="#monitoring-your-app" title="Permanent link"></a></h3>
<p>Open the Application Insights created by Azure Spring Cloud and start monitoring Spring Boot applications. You can find the Application Insights in the same Resource Group where you created an Azure Spring Cloud service instance.</p>
<p><img alt="Application Insights Overview" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-overview.png" /></p>
<p>Navigate to the Performance blade</p>
<p><img alt="Application Insights Performance, Operations" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-performance-operations.png" /></p>
<p>Click on Dependencies, you can see the performance number for dependencies to the services</p>
<p><img alt="Application Insights Performance, Dependencies" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-performance-dependencies.png" /></p>
<p>Click on Roles, you can see the performance number to compare across instances and roles</p>
<p><img alt="Application Insights Performance, Roles" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-performance-roles.png" /></p>
<p>Navigate to the Application Map blade</p>
<p><img alt="Application Insights Application Map" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-applicationmap.png" /></p>
<p>Navigate to the Failures blade</p>
<p><img alt="Application Insights Failures, Dependencies" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-failures-dependencies.png" /></p>
<p>Click on Exceptions, you can see a collection of exceptions</p>
<p><img alt="Application Insights Failures, Exceptions" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-failures-exceptions.png" /></p>
<p>Click on an exception to see the end-to-end transaction and stacktrace in context</p>
<p><img alt="Application Insights Failures, Exceptions Details" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-failures-exceptions-details.png" /></p>
<p>Navigate to the Metrics blade</p>
<p><img alt="Application Insights Metrics" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-metrics-live.png" /></p>
<blockquote>
<p>Note: Spring Boot registers a lot number of core metrics: JVM, CPU, Tomcat, Logback and so on. You can find custom metrics for these. The Spring Boot auto-configuration enables the instrumentation of requests handled by Spring MVC. All those three REST controllers OwnerResource, PetResource and VisitResource have been instrumented by the <a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Timed" title="GitHub User: Timed">@Timed</a> Micrometer annotation at class level</p>
</blockquote>
<p>Navigate to Live Metrics blade, you can see live metrics on screen with low latencies &lt; 1 second
<img alt="Application Insights Live Metrics" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-appinsights-metrics.png" /></p>
<h2 id="petclinic-swaggeroas3-for-api-management-integration">PetClinic Swagger/OAS3 for API Management Integration<a class="headerlink" href="#petclinic-swaggeroas3-for-api-management-integration" title="Permanent link"></a></h2>
<p>Find this <a href="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/README-swagger.md">document</a> for the instructions</p>
<h2 id="fully-managed-testing-for-petclinic-app">Fully managed testing for PetClinic app<a class="headerlink" href="#fully-managed-testing-for-petclinic-app" title="Permanent link"></a></h2>
<p>Find this <a href="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/README-test.md">document</a> for the instructions</p>
<h2 id="petclinic-on-automated-cicd-with-github-action">PetClinic on Automated CI/CD with GitHub Action<a class="headerlink" href="#petclinic-on-automated-cicd-with-github-action" title="Permanent link"></a></h2>
<ul>
<li>CI and CI/CD Workflows</li>
<li>Configure workflows for CI</li>
<li>Configure workflows for CI/CD</li>
<li>Reviewing workflows</li>
</ul>
<h3 id="before-you-start_1">Before you start<a class="headerlink" href="#before-you-start_1" title="Permanent link"></a></h3>
<p>You need two Azure credentials stored on the repo. One&rsquo;s for Azure login from CLI, the other&rsquo;s for AZURE_CLIENT_SECRET to pass to the apps as the environment variables. From the top menu on the repo, select Settings, click on Secrets on left menu and click on Actions. Click on New repository secret, and save your Service Principal details as AZURE_CREDENTIALS01 that you saved in the initial steps. And another is AZURE_CLIENT_SECRET as AZURE_CREDENTIALS02, repeat the steps and save</p>
<p><img alt="Repo Secretes" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-repo-secrets.png" /></p>
<h3 id="ci-and-cicd-workflows">CI and CI/CD Workflows<a class="headerlink" href="#ci-and-cicd-workflows" title="Permanent link"></a></h3>
<p>There are two workflows defined in <code>.github\workflows</code> </p>
<ul>
<li>ci-build-all.yml &hellip; full build by Maven with testing</li>
<li>cd-build-deploy-all.yml &hellip; full build by Maven skipping testing and deploy</li>
</ul>
<p>Go to Actions on your repo, it will look like this</p>
<p><img alt="Workflows" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-workflows.png" />    </p>
<h3 id="configure-workflows-for-ci">Configure workflows for CI<a class="headerlink" href="#configure-workflows-for-ci" title="Permanent link"></a></h3>
<p>For <code>ci-build-all.yml</code>, update PROJECT_NAME, AZURE_RESOURCE_GROUP_NAME on env section on the top</p>
<div class="highlight"><pre>name: PetClinic - Full Build, Maven

on:
  workflow_dispatch:  # works manually
#  push:
#    branches: [ your brandch name here ]
#  pull_request:
#    branches: [ your brandch name here ]

env:
  PROJECT_NAME: &#39;your project name here&#39;
  AZURE_RESOURCE_GROUP_NAME: &#39;your resource group name here&#39; 
..
</pre></div>

<p>It consists of these steps 
1. Checkout the repo
2. Seting up Java 11 with Maven cache config
3. Log on to Azure
4. Setting up redisson.json with your Redis key as password and place it to <code>/src/main/resources/</code> of each app components
5. Maven clean, package with test
6. Log out from Azure</p>
<h3 id="configure-workflows-for-cicd">Configure workflows for CI/CD<a class="headerlink" href="#configure-workflows-for-cicd" title="Permanent link"></a></h3>
<p>For <code>cd-build-deploy-all.yml</code>, </p>
<div class="highlight"><pre>name: PetClinic - Build &amp; Deploy, Maven

on:
  workflow_dispatch:  # works manually
#  push:
#    branches: [ your brandch name here ]
#  pull_request:
#    branches: [ your brandch name here ]

env:
  PROJECT_NAME: &#39;your project name here&#39;
  ASC_PACKAGE_PATH: ${{ github.workspace }}
  AZURE_SUBSCRIPTION_ID: &#39;your subscription id here&#39;
  AZURE_RESOURCE_GROUP_NAME: &#39;your resource group name here&#39;
  AZURE_LOCATION: &#39;target region here&#39;
  SPRING_CLOUD_SERVICE: &#39;your spring cloud instance name here&#39;
..

  AZURE_CLIENT_ID: &#39;your client id&#39;
  AZURE_CLIENT_SECRET: ${{ secrets.AZURE_CREDENTIALS02 }}
  AZURE_TENANT_ID: &#39;your tenant id&#39;
  KEYVAULT_URI: &#39;your Key Vault URI&#39;
</pre></div>

<p>It consists of these steps 
1. Checkout the repo
2. Seting up Java 11 with Maven cache config
3. Log on to Azure
4. Setting up redisson.json with your Redis key as password and place it to <code>/src/main/resources/</code> of each app components
5. Maven clean, package skipping test
6. Deploy the apps for each - <code>api-gateway</code>, <code>admin-server</code>, <code>customers-service</code>, <code>vets-service</code>, <code>visits-service</code>, <code>consumer-service</code>
7. Log out from Azure</p>
<h3 id="reviewing-workflows">Reviewing workflows<a class="headerlink" href="#reviewing-workflows" title="Permanent link"></a></h3>
<p>Navigate to Actions on your repo</p>
<p><img alt="CD" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-cd.png" /> </p>
<p>Click on the latest item</p>
<p><img alt="Summary CD" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-summary-cd.png" /></p>
<p>It looks like this for CI workflows</p>
<p><img alt="Summary CI" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-summary-ci.png" /></p>
<p>It looks like this when it&rsquo;s working</p>
<p><img alt="Working CD" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-working-cd.png" /></p>
<p>When it&rsquo;s successfully done with test steps, it looks like this</p>
<p><img alt="Done CD" src="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/media/step-gh-done-cd.png" />        </p>
<h2 id="automated-cicd-in-practice">Automated CI/CD in practice<a class="headerlink" href="#automated-cicd-in-practice" title="Permanent link"></a></h2>
<p>Find this <a href="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/README-cicd.md">document</a> for furtehr details</p>
<h2 id="known-issues">Known issues<a class="headerlink" href="#known-issues" title="Permanent link"></a></h2>
<h3 id="warning-no-unused-params">Warning: no-unused-params<a class="headerlink" href="#warning-no-unused-params" title="Permanent link"></a></h3>
<p>```text wrap
/mnt/c/Workspace/Lombard/dai001/spring-petclinic-microservices/iac/bicep/spc-main.bicep(12,5) : Warning no-unused-vars: Variable &ldquo;vSAName&rdquo; is declared but never used. [<a href="https://aka.ms/bicep/linter/no-unused-vars">https://aka.ms/bicep/linter/no-unused-vars</a>]
<div class="highlight"><pre>**Solution:**
Simply ignore these warnings while runing `az deployment group create`. It&#39;s because of optional paramaters unused while creating the resources. You can just ignore these when you try this with CLI or Quick Start Button but in Git Hub Action, you need to skip this warnings by adding `continue-on-error: true` to Jobs or Steps. That&#39;s because current version of deployment agent in Azure CLI detects it&#39;s an error than warning

### Error:  Failed to perform fetch

```text wrap
org.eclipse.jgit.api.errors.TransportException: Missing delta base 02b518cc23536be854b9f58a136fb10c03468649
    at org.eclipse.jgit.api.FetchCommand.call (FetchCommand.java:224)
    at pl.project13.core.JGitProvider.fetch (JGitProvider.java:364)
    at pl.project13.core.JGitProvider.getAheadBehind (JGitProvider.java:351)
</pre></div></p>
<p><strong>Solution:</strong>
It&rsquo;s simply ingored while running the workflows on the Actions as default. It occurs when Maven tries to update local repo with the dependencies for the builds. Functionally there&rsquo;s no issues by this</p>
<h2 id="credits">Credits<a class="headerlink" href="#credits" title="Permanent link"></a></h2>
<p>This Spring microservices example is forked from 
<a href="https://github.com/Azure-Samples/spring-petclinic-microservices">Azure-Samples/spring-petclinic-microservices</a> - see <a href="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/README-azure-examples.md">Petclinic README</a>) and originated from <a href="https://github.com/spring-petclinic/spring-petclinic-microservices">spring-petclinic/spring-petclinic-microservices</a> - see <a href="/C:/Workspace/Lombard/dai001/spring-petclinic-microservices-dev/README-petclinic.md">Petclinic README</a>. </p>
<h2 id="contributing">Contributing<a class="headerlink" href="#contributing" title="Permanent link"></a></h2>
<p>This project welcomes contributions and suggestions.  Most contributions require you to agree to a
Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us
the rights to use your contribution. For details, visit <a href="https://cla.opensource.microsoft.com">https://cla.opensource.microsoft.com</a>.</p>
<p>When you submit a pull request, a CLA bot will automatically determine whether you need to provide
a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions
provided by the bot. You will only need to do this once across all repos using our CLA.</p>
<p>This project has adopted the <a href="https://opensource.microsoft.com/codeofconduct/">Microsoft Open Source Code of Conduct</a>.
For more information see the <a href="https://opensource.microsoft.com/codeofconduct/faq/">Code of Conduct FAQ</a> or
contact <a href="mailto:opencode@microsoft.com">opencode@microsoft.com</a> with any additional questions or comments.</p>
<h2 id="trademarks">Trademarks<a class="headerlink" href="#trademarks" title="Permanent link"></a></h2>
<p>This project may contain trademarks or logos for projects, products, or services. Authorized use of Microsoft trademarks or logos is subject to and must follow <a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general">Microsoft&rsquo;s Trademark &amp; Brand Guidelines</a>. Use of Microsoft trademarks or logos in modified versions of this project must not cause confusion or imply Microsoft sponsorship. Any use of third-party trademarks or logos are subject to those third-party&rsquo;s policies.</p></article></body></html>